generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model events {
  id   Int    @id @default(autoincrement())
  day  String @unique @db.VarChar(10)
  type String @db.VarChar
}

model referents {
  id    Int     @id @default(autoincrement())
  name  String  @unique @db.VarChar
  slots slots[]
}

model slots {
  id        Int        @id @default(autoincrement())
  ref_id    Int?
  day       String     @db.VarChar(10)
  start_at  DateTime   @db.Time(6)
  end_at    DateTime   @db.Time(6)
  referents referents? @relation(fields: [ref_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Gym {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  walls       Wall[]
  routes      Route[]
}

model Wall {
  id          Int      @id @default(autoincrement())
  gym_id      Int
  gym         Gym      @relation(fields: [gym_id], references: [id], onDelete: Cascade)
  name        String   @db.VarChar(100)
  description String?  @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  photo_id    Int      @unique
  photo       Photo    @relation(fields: [photo_id], references: [id])
  moves       Move[]
}

model Photo {
  id          Int      @id @default(autoincrement())
  file_path   String   @db.VarChar(500)
  file_name   String   @db.VarChar(255)
  mime_type   String   @db.VarChar(50)
  file_size   Int
  uploaded_at DateTime @default(now())

  wall Wall?
}

model Route {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  grade       String   @db.VarChar(10)
  description String?  @db.Text
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  body        Json?    @db.JsonB // DEPRECATED: use moves relation instead
  moves       Move[]
  gym         Gym?     @relation(fields: [gymId], references: [id])
  gymId       Int?
}

model Move {
  id      Int            @id @default(autoincrement())
  routeId Int            @map("route_id")
  x       Float
  y       Float
  type    enum_move_type
  radius  Float
  wallId  Int            @map("wall_id")
  route   Route          @relation(fields: [routeId], references: [id], onDelete: Cascade)
  wall    Wall           @relation(fields: [wallId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("moves")
}

enum enum_move_type {
  hand_start
  foot_start
  hand
  foot
  both
  finish
}
